* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v1.8 on Apr, 20. 2017. JOBID=1492717725
* SETUP PERIODIC BOUNDARY CONDITION 
* 

DIMENS CHSIZE 3000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

!Read PSF and Coordinates 
open read unit 10 card name step3_crys_complex.psf
read psf  unit 10 card

stream step4_solvator.str

open read unit 10 card name step4_solvator.crd
read coor unit 10 card

coor sdrude
coor shake

!! drude minimization (skip if necessary)
!cons harm force 1000000.0 sele .not. type D* end
!mini SD nstep 200
!cons harm force 0.0 sele .not. type D* end

!
! Setup PBC (Periodic Boundary Condition)
!
stream step4.1_waterbox.prm
COOR CONVERT ALIGNED SYMMETRIC @A @B @C @alpha @beta @gamma
open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!crystal build noper 0 cutoff 16.0
!Image centering by residue
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname SWM4 end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele ( segid @posid .or. segid @negid ) end

!
! Nonbonded Options
!

!system "python checkfft.py ?XTLA ?XTLB ?XTLC > checkfft.str"
!stream checkfft.str


!
! Nonbonded Options
!
set 3 16.0  ! cutim
set 4 16.0  ! cutnb
set 5 10.0  ! ctonnb
set 6 12.0  ! ctofnb
set 7 switch
set 8 atom
set 9 vatom
set 10 vswitch
set kap 0.34 ! epsilon for the PME
set ord 6    ! spline order for PME
! fftx dimensions should correspond to 1 A or less; must
! be power of 2, 3 or 5
set fftx 64
set ffty 64
set fftz 64
update inbfrq -1 imgfrq -1 ihbfrq 0 -
ewald pmewald kappa @kap fftx @fftx ffty @ffty fftz @fftz order @ord lrc -
@7 @8 @9 @10 cutimg @3 cutnb @4 ctofnb @6 ctonnb @5

energy

!
! cons fix all heavy atoms except generated water molecules and 
! short minimization
!


cons fix sele .not. ( hydrogen .or. segid SOLV .or. segid @posid .or. segid @negid ) end
cons harm force 0.1 sele segid @posid .or. segid @negid end

mini SD   nstep 50 nprint 5
mini ABNR nstep 50 nprint 5

cons fix sele none end

!
! Write coordinates and system information
!

open write unit 10 card name step5_pbcsetup.psf
write  psf unit 10 card

open write unit 10 card name step5_pbcsetup.pdb
write coor unit 10 pdb  

open write unit 10 card name step5_pbcsetup.crd
write coor unit 10 card

open  write unit 90 card name step5_pbcsetup.str
write title unit 90
* set XTLtype  = @XTLtype
* set A = @A
* set B = @B
* set C = @C
* set Alpha = @Alpha
* set Beta  = @Beta
* set Gamma = @Gamma
* set fftx     = @fftx
* set ffty     = @ffty
* set fftz     = @fftz
* set posid = @posid
* set negid = @negid
* set xcen = @xcen
* set ycen = @ycen
* set zcen = @zcen
*
 

stop
